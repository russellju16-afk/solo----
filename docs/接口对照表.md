# 接口对照表（前台/后台）

后端服务基址：`http://localhost:3002`（Nest 全局前缀：`/api`）  
前台/后台本地开发：通过 Vite proxy 访问同路径的 `/api/**` 与 `/uploads/**`

鉴权约定：
- **Public**：无需 token
- **Admin**：`Authorization: Bearer <token>`（通过 `POST /api/auth/login` 获取）

---

## Auth

### `POST /api/auth/login`（Public）

Body（JSON）：
```json
{ "username": "admin", "password": "123456" }
```

Response（示例）：
```json
{
  "token": "eyJhbGciOiJIUzI1...",
  "userInfo": { "id": 1, "username": "admin", "name": "管理员", "phone": "", "role": "admin" }
}
```

---

## Upload（重点）

### `POST /api/admin/upload/image`（Admin）

说明：
- 表单字段名：`file`
- 限制：5MB、`png/jpg/jpeg/webp`

Request（multipart/form-data）：
```bash
curl -X POST http://localhost:3002/api/admin/upload/image \
  -H "Authorization: Bearer <token>" \
  -F "file=@/path/to/file.webp;type=image/webp"
```

Response（示例）：
```json
{ "url": "/uploads/22c348bd-fe8c-4871-94eb-6e9cf4ea9cd2.webp" }
```

### `GET /uploads/:filename`（Public）

示例：`http://localhost:3002/uploads/22c348bd-fe8c-4871-94eb-6e9cf4ea9cd2.webp`

---

## Banner

### `GET /api/banners`（Public）

Query：
- `position?: string`
- `enabled?: 0 | 1`（前台默认只返回启用的）

Response（示例）：
```json
[
  {
    "id": 1,
    "position": "home_top",
    "title": "验收Banner-1765679768",
    "sub_title": "上传链路验收",
    "image_url": "/uploads/226aab6d-db73-4207-975b-e9442afaa838.webp",
    "link_url": "",
    "sort_order": 99,
    "enabled": 1
  }
]
```

### `GET /api/admin/banners`（Admin）
同上，但可获取全部（含禁用）。

### `POST /api/admin/banners`（Admin）

Body（关键字段）：
```json
{
  "position": "home_top",
  "title": "xxx",
  "sub_title": "xxx",
  "image_url": "/uploads/xxx.webp",
  "link_url": "",
  "sort_order": 99,
  "enabled": 1
}
```

---

## News

### `GET /api/news`（Public）

Query：
- `page` / `pageSize`
- 后端前台默认只返回 `status=published`

Response（示例）：
```json
{
  "data": [
    {
      "id": 1,
      "title": "验收新闻-1765679768",
      "category": "公司新闻",
      "cover_image": "/uploads/9194b0e2-d12f-4e77-853c-36c3a3aa1f76.webp",
      "status": "published"
    }
  ],
  "total": 1,
  "page": 1,
  "pageSize": 5
}
```

### `GET /api/news/:id`（Public）

### `GET /api/admin/news` / `POST /api/admin/news` / `PUT /api/admin/news/:id` / `DELETE /api/admin/news/:id`（Admin）

创建/更新保存字段重点：
- `cover_image` 保存为 `/uploads/...` 字符串

---

## Cases

### `GET /api/cases`（Public）
Query：`page/pageSize/keyword/industry_type`（前台默认 `status=published`）

### `GET /api/cases/:id`（Public）

### `GET /api/admin/cases` / `POST /api/admin/cases` / `PUT /api/admin/cases/:id` / `DELETE /api/admin/cases/:id`（Admin）

字段重点：
- `cover_image` 保存为 `/uploads/...` 字符串

---

## Solutions

### `GET /api/solutions`（Public）
Query：`page/pageSize/channel_type/enabled`

### `GET /api/solutions/:id`（Public）

### `GET /api/admin/solutions` / `POST /api/admin/solutions` / `PUT /api/admin/solutions/:id` / `DELETE /api/admin/solutions/:id`（Admin）

字段重点：
- `cover_image?: string`（已补齐，保存为 `/uploads/...`）

---

## Products

### `GET /api/categories`（Public）

Response（示例）：
```json
[
  { "id": 1, "name": "大米", "sort_order": 0 },
  { "id": 2, "name": "验收分类-1765679768", "sort_order": 99 }
]
```

### `GET /api/products`（Public）

Query：
- `page/pageSize`
- `categoryId?: number`
- `keyword?: string`

Response（示例，列表带 `cover_image`）：
```json
{
  "data": [
    {
      "id": 1,
      "name": "验收产品-1765679768",
      "cover_image": "/uploads/9194b0e2-d12f-4e77-853c-36c3a3aa1f76.webp",
      "category": { "id": 2, "name": "验收分类-1765679768" },
      "brand": { "id": 2, "name": "验收品牌-1765679768" }
    }
  ],
  "total": 1,
  "page": 1,
  "pageSize": 5
}
```

### `GET /api/products/:id`（Public）
Response 会包含 `images: [{ url, sort_order }]`。

### `GET /api/products/:id/recommendations`（Public）

Query：
- `limit?: number`（默认 4）
- `categoryId?: number`（可选，不传则后端尝试从产品本身推断）

Response（示例，当前数据量不足时返回空数组）：
```json
[]
```

### Admin 侧产品相关

- `GET /api/admin/products`
- `POST /api/admin/products`
- `PUT /api/admin/products/:id`
- `PUT /api/admin/products/:id/status`
- `DELETE /api/admin/products/:id`
- `GET /api/admin/categories` / `POST /api/admin/categories` / ...
- `GET /api/admin/brands` / `POST /api/admin/brands` / ...

字段重点：
- 创建/更新产品时使用：
  - `category_id` / `brand_id`
  - `images: string[]`（URL 数组，保存到 `product_images`）

---

## Leads（重点）

### `POST /api/leads`（Public）

Body（示例）：
```json
{
  "name": "张三",
  "companyName": "某某公司",
  "phone": "13800000000",
  "city": "西安",
  "channelType": "university",
  "interestedCategories": ["rice", "oil"],
  "monthlyVolumeSegment": "between_5_20t",
  "brandRequirement": "无",
  "description": "希望获取报价",
  "source": "contact_page"
}
```

Response：
```json
{ "success": true, "id": 3 }
```

### `POST /api/leads/signal`（Public）
用于埋点/行为线索。

### `GET /api/admin/leads`（Admin）

Query：
- `page/pageSize`
- `keyword/status/leadType/channelType/dateFrom/dateTo/...`

Response（示例，字段齐全）：
```json
{
  "items": [
    {
      "id": 3,
      "leadType": "form",
      "companyName": "验收公司",
      "interestedCategories": ["rice", "oil"],
      "source": "contact_page",
      "status": "new"
    }
  ],
  "total": 3,
  "page": 1,
  "pageSize": 1
}
```

### 线索跟进/导出（Admin）

- `GET /api/admin/leads/export`
- `GET /api/admin/leads/:id/followups`
- `POST /api/admin/leads/:id/followups`

---

## Company Info

### `GET /api/company-info`（Public）
当前为空对象时前台会使用默认值兜底。

### `GET /api/admin/company-info` / `PUT /api/admin/company-info`（Admin）

---

## Analytics

### `POST /api/track`（Public）
前台 `src/utils/track.ts` 会调用（beacon/fetch），用于统计事件。

---

## FAQs（新增补齐）

### `GET /api/faqs`（Public）

Query：
- `pageSize` / `limit`
- `categoryId`（可选）

Response：FAQ 数组（用于 Contact/ProductDetail）


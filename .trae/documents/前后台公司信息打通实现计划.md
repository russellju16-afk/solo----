# 前后台公司信息打通实现计划

## 一、项目现状分析

1. **后端**：已完整实现公司信息管理功能
   - 实体 `CompanyInfo` 包含所有必要字段
   - 服务 `CompanyService` 提供 `getInfo()` 和 `updateInfo()` 方法
   - 控制器提供三个端点：
     - `GET /company-info`：前台公共端点（无需认证）
     - `GET /admin/company-info`：后台管理端点（需JWT认证）
     - `PUT /admin/company-info`：后台更新端点（需JWT认证）

2. **前台**：已有基础实现，但部分页面仍使用硬编码数据
   - `src/services/company.ts`：已实现 `fetchCompanyInfo()` 方法
   - `src/types/company.ts`：已定义 `CompanyInfo` 接口
   - `Home` 页面：已使用 `fetchCompanyInfo()` 获取公司信息
   - `About`、`Contact` 页面和 `Footer` 组件：仍使用硬编码数据

## 二、实现步骤

### 1. 创建自定义 Hook `useCompanyInfo`

- **目标**：复用公司信息获取逻辑，避免重复请求
- **文件**：`src/hooks/useCompanyInfo.ts`
- **功能**：
  - 封装 `fetchCompanyInfo()` 调用
  - 管理加载状态和错误处理
  - 提供公司信息数据

### 2. 修改 `About` 页面

- **目标**：使用动态获取的公司信息替换硬编码数据
- **文件**：`src/pages/About/index.tsx`
- **修改点**：
  - 公司简介内容
  - 公司形象图片
  - Helmet 标题和描述

### 3. 修改 `Contact` 页面

- **目标**：使用动态获取的公司信息替换硬编码数据
- **文件**：`src/pages/Contact/index.tsx`
- **修改点**：
  - 公司地址、电话、邮箱
  - 工作时间
  - 微信二维码
  - Helmet 标题和描述

### 4. 修改 `Footer` 组件

- **目标**：使用动态获取的公司信息替换硬编码数据
- **文件**：`src/components/layout/Footer.tsx`
- **修改点**：
  - 公司名称和简介
  - 联系信息（地址、电话、邮箱、工作时间）

### 5. 优化请求策略

- **目标**：减少重复请求，提高性能
- **方案**：
  - 在 `AppLayout` 组件中加载公司信息
  - 使用 React Context 或简单的 props 传递
  - 页面组件只负责读取和展示数据

## 三、代码实现细节

### 1. 自定义 Hook `useCompanyInfo`

```ts
import { useState, useEffect } from 'react';
import { fetchCompanyInfo } from '@/services/company';
import { CompanyInfo } from '@/types/company';

export const useCompanyInfo = () => {
  const [companyInfo, setCompanyInfo] = useState<CompanyInfo | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<Error | null>(null);

  useEffect(() => {
    const loadCompanyInfo = async () => {
      setLoading(true);
      try {
        const data = await fetchCompanyInfo();
        setCompanyInfo(data);
      } catch (err) {
        setError(err instanceof Error ? err : new Error('Failed to fetch company info'));
      } finally {
        setLoading(false);
      }
    };

    loadCompanyInfo();
  }, []);

  return { companyInfo, loading, error };
};
```

### 2. 修改页面组件

- 在每个需要公司信息的组件中使用 `useCompanyInfo()` Hook
- 添加适当的加载状态和错误处理
- 替换硬编码数据为动态数据

### 3. 优化请求策略

- 在 `AppLayout` 中使用 `useCompanyInfo()` 获取公司信息
- 通过 props 将公司信息传递给子组件
- 避免在多个页面重复调用 API

## 四、测试计划

1. **启动服务**：
   - 后端服务：`npm run start:dev`（端口 3000）
   - 前台服务：`npm run dev`（端口 5173）
   - 后台服务：`npm run dev`（端口 3001）

2. **功能测试**：
   - 在后台管理页面修改公司信息
   - 刷新前台页面，验证信息是否更新
   - 检查所有相关页面（Home、About、Contact、Footer）是否显示正确

3. **性能测试**：
   - 检查网络请求，确保公司信息只请求一次
   - 验证加载状态和错误处理是否正常工作

## 五、预期效果

1. 所有前台页面的公司信息均来自后端动态数据
2. 后台修改公司信息后，前台页面刷新即可看到更新
3. 减少了重复的 API 请求，提高了性能
4. 代码结构更加清晰，逻辑复用性更高

## 六、风险评估

1. **API 响应格式不一致**：
   - 风险：后端返回的数据格式与前端期望不符
   - 缓解：确保前后端 `CompanyInfo` 类型一致，添加适当的数据转换逻辑

2. **网络请求失败**：
   - 风险：公司信息请求失败导致页面显示异常
   - 缓解：添加适当的错误处理和默认值

3. **环境变量配置错误**：
   - 风险：前台 API 基础 URL 配置错误
   - 缓解：检查 `.env` 文件中的 `VITE_API_BASE_URL` 配置

## 七、完成标准

1. 所有前台页面（Home、About、Contact、Footer）的公司信息均来自后端 API
2. 后台修改公司信息后，前台页面刷新即可看到更新
3. 代码结构清晰，复用性高
4. 项目能够正常构建和运行
5. 没有明显的性能问题

通过以上计划，我们将实现前后台公司信息的打通，确保前台页面展示的公司信息始终与后台配置保持一致。